---
/**
 * partial/compare-table.astro
 * Recibe el JSON enviado por compare.astro y pasa los props a CompareTable.astro
 * Compatible con el nuevo formato { cotizaciones: [...], campos: [...] }
 */

 import CompareTableComponent from "../../components/CompareTable.astro";

const formData = await Astro.request.formData();
const raw = formData.get("resultados");
console.log("üì® partial/compare-table ‚Üí body recibido:", raw);

let cotizaciones: any[] = [];
let campos: string[] = [];

if (raw && raw.trim() !== "") {
  try {
    const parsed = JSON.parse(raw);
    console.log("üì¶ JSON parseado correctamente:", parsed);

    // Detectar estructura del payload
    if (Array.isArray(parsed.cotizaciones)) {
      cotizaciones = parsed.cotizaciones;
      campos = parsed.campos || [];
    } else if (Array.isArray(parsed)) {
      // Fallback (compatibilidad antigua)
      cotizaciones = parsed;
    } else if (Array.isArray(parsed.resultados)) {
      cotizaciones = parsed.resultados;
      campos = parsed.campos || [];
    }

    console.log(`üß© Cotizaciones: ${cotizaciones.length}, Campos: ${campos.length}`);
  } catch (err) {
    console.error("‚ùå Error parseando JSON en partial:", err);
  }
} else {
  console.warn("‚ö†Ô∏è partial/compare-table recibi√≥ body vac√≠o.");
}
---

<CompareTableComponent cotizaciones={cotizaciones} campos={campos} />
